name: Comment when fixed in beta

on:
  issues:
    types: [labeled]

jobs:
  comment-when-fixed-in-beta:
    # Nur ausfÃ¼hren, wenn das neu hinzugefÃ¼gte Label "fixedInBeta" ist
    if: github.event.label.name == 'status/fixedInBeta'
    runs-on: ubuntu-latest

    steps:
      - name: Add comment with beta download link
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issueNumber = context.payload.issue.number;

            // Repo-Infos robust aus Umgebungsvariable holen
            const [owner, repo] = process.env.GITHUB_REPOSITORY.split("/");
            console.log(`owner=${owner}, repo=${repo}, issue=${issueNumber}`);

            const lines = [
              "âœ… This issue has been marked as **fixed in the latest beta version** of the app.",
              "",
              "You can download the current beta APK here:",
              "ðŸ‘‰ https://github.com/MeterReadings/meter-readings-apk/releases/latest",
              "",
              "Please install that beta build, try to reproduce the problem again,",
              "and then leave a comment in this issue to confirm whether the bug is really fixed.",
              "",
              "**Important:** Before installing the beta, create a backup of your database:",
              "App â†’ Settings â†’ Database settings â†’ Export database (save it to local storage, not to a cloud folder)."
            ];

            const body = lines.join("\n");

            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: issueNumber,
              body
            });
